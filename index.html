<!DOCTYPE HTML>
<html>
	<head>
		<title>Isekai Story Taller</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="utf-8">
		<link rel="stylesheet" href="styles.css">
		<script src="scripts/game.js"></script>
		<script src="scripts/systems.js"></script>
		<script src="scripts/managers/math_manager.js"></script>
		<script src="scripts/managers/canvas_manager.js"></script>
		<script src="scripts/managers/events_manager.js"></script>
		<script src="scripts/managers/resources_manager.js"></script>
	</head>
	<body>
		<canvas id="game"></canvas>
		<script defer>
			
			// Init game
			let game = new Game()
			
			// Init managers
			CanvasManager.init()
			EventsManager.init()
			ResourcesManager.init()
			
			// System registration
			game.registerSystem(new CameraContollerSystem())
			game.registerSystem(new GridControllerSystem())
			game.registerSystem(new GridPositionSystem())
			game.registerSystem(new GridCollisionSystem())
			game.registerSystem(new ChunkRenderSystem())
			game.registerSystem(new RenderSystem())
			
			// Loading images
			ResourcesManager.loadTexture("rock_tileset", "textures/tilesets/rock.png")
			ResourcesManager.loadTexture("test_entity", "textures/entities/test.png")
			ResourcesManager.loadTexture("test_tile", "textures/void.png")
			
			// Map
			let chunk = game.addEntity({
				"Position" : {x : 0, y : 0},
				"Chunk" : {cols : 16, rows : 16, tile_width : 64, tile_height : 64},
				"ChunkFilling" : {texture : "test_tile"},
				
			})
			
			// Entities
			let player = game.addEntity({
				"GridPosition" : {x : 10, y : -2},
				"GridCellSize" : {width : 64, height : 64},
				"GridController" : {},
				"GridCollider" : {},
			
				"Visual" : {strategy : "SpriteRender", visible=true},
				"SpriteVisual" : {texture : "test_entity", offset : {x : 0, y : -50}},
				
				"Speed" : {speed : 3},
				"CameraController" : {lerp : 0.1},
			})
			
			let enemy = game.addEntity({
				"GridCellSize" : {width : 64, height : 64},
				"GridPosition" : {x : 5, y : 3},
				"GridCollider" : {},
				
				"Visual" : {strategy : "SpriteRender", visible=true},
				"SpriteVisual" : {texture : "test_entity", offset : {x : 0, y : -50}},
				
				"Speed" : {speed : 3},
			}) 
			
			game.start()
		</script>
	</body>
</html>
